<!--
	THIS EXAMPLE WAS DOWNLOADED FROM https://echarts.apache.org/examples/en/editor.html?c=bar-waterfall2&code=DYUwLgBAJghmMEEAeBLAzhAvBA2gJgAYBGAVgBoJCiA2CqgdjuIA4miBOJwrorvLgMxcALFxIBdANwAoUJABOMFADsEAWwD2AV2VgM2HMILCAdLQgDm1E40rtylIkRMP61U6wjD29E5wgk7M5CFszMLhTslmYUwtQkMRb04XhS0rLg0CgAZtkg8iDKAMYg-rhp2RryEAAUchAoWBBEkg0QADwQiirq2rpoJqDKAOZgABatKADUUwCUEADe0hBZufmFJQMADlpoYzXdqpo6ejgo4hAAtF1KR32nKJdE4rMyAL7pRRrKaBqggxphjUAOQAERyeQKxVKAC5gRQoBD1tC0K90vUtho0CgwCgAG4gUFwGBNHBperKEDDOD4wnE0nkzJbYAwEpjP5QfJE-AMmQYgp4lDaNAAZS0alJh16JzQOAI4nE6WZrJA7OAnPk3JgJh2ewOt2l_TlLxk0kq1TqmUa2AIkw6q0hG1Kg0KowmDRm8yWK3qiNyTS2MHkaBAADFgBo4DU_Y6UWcTcsIImcrUYxAAHw2r2JlaY7G4glanW7fYxkxgDShlBIEBQGpEWZolYrSnUgt0-DFvXAy7A14QAD0A4gAFUQxACA0fmAQDAoBANNkID3gRBzRAtvINFt8hA0PAigBrFTDRNvCAgYDj73NvM42lF3X7Ff9oej8eTlT72fzxfL3trlUG5bju1T7qyx4jDmECtjShbEl2-wALJwGMJgwAARmg0YQrM5aVtWtb1o2MgrB8KzpCsb4IFA87jCAEBFOKWgsu2EB4jAwBaAx670TBIBIJAypshy-TJkuOH-p0BDZs2G4siJ6pcghT41MJqqiZqxLxhAUwOk2EDnpe17QbmCkaUpWmdqp6lqhqWrxgZHwfLZmlagG5l2cpnZoMAKAlMRprbri3xNDeuJgKAMKLNBM6CdFwIAGpBigMAAOcAMcaBACDKFonHQAxADCYxaBxVwQKGMAAF6FLAEBFUGygwAAXxhMDAmeZCJhWfy4ls0U3isYDyCgwzDPkCUwKgaDwtB03oAAChoKgzvIg2mRAYAAJ47glexzhoADunVyW83VyeaahwGt0XZDoRQhcotSBooaiojFck-pk8DyKRX0pmpQYwO9ODPBAABkEMbsDoPPCYHFcQxACEmDYC-n1fcNQYBrDsrPP9Z0XleDGA69IOyqkkPQ-ToOpAjnHcRAqPo72slY1tOPYLTlNpFjRkk5jWO_bjb2yvKhPNuRX0FGAWjyM9v0mM1agMXpwLtBh8gDumq56TUSshqNpQAHIgwxaPo4tnmaauAD8y4ACoaPAwA5UxagsYdq7RYb-QoKb5vzOrEAJbpnPyAzSPh6uahqMCkvS-diagBNyhQBtcmwPA0U4MCCDioUFbwsuABKtZaJlGgl8Czuu-7zEslA1eKmRF0QMMo0Z0LECgNkYAJQIACkc1yaNwxjAPy7CCP7crBhLsVmog-z9BXy6LcAAymGXr78jcV1iZIMg6CZ82O17cuRRwFSVTbaPzbZzA0VPyfaCHys21v2fw27SACWI24g_Fs5sEqJT-IXQqDVSrlRqHHWYwCIALTQNvDCu8e4rCujdSay4FiAJAOeOOp0pYfz3P7WEuBoJDWbCrf-y5rYqi8vIRBv9L7AnaswuezZwJHgSnXTiLC9woCGFPEa3EuErBxCANQIodpRQwc2Be8gNRFT-FUBKI0YA_FekXQRKwvgRnWsuTR2igy6M2snLG0ithjBgNiNAP8AYzhkXIuh1CsZKJUWooxwITFoB0boPRzYDHqOMYoUxUIwDEP5hYiR0BiTRVcpZLUcSWRoOAI4uSexjp73EZtXMWJ7zfASl-FAnIglYLALdXBRRCHxwsdBSxzZ3EwVAcuAuqtdDVziRfOh7CgyCJ4YePhLsBGpJ3hkhRKxslHVySAOJBT8xCmUBo7cFSqjXSqTg4EUwFi1IgEQ2Jm0pEuO2vIlp-jvEJQAMRBCKkVegJBVxHKxk_RJhT2xakaVwlptCErlygJXLKgjekJQ4YMg8wynajOAIItJ6CLl7nZLMra-95n5I3B85ZqytjrPkJs6pPY9l1OiVLOJJzZFnLcRikJPjrkAFF6XUGZdQZ5_M4lvP4m2B8xJGmJkVG8SQQA
	⚠ Please be aware that this chart is not an official demo of Apache ECharts but is made by user-generated code.
-->
<!DOCTYPE html>
<html lang="en" style="height: 100%">
<head>
  <meta charset="utf-8">
</head>
<body style="height: 100%; margin: 0">
  <div id="container" style="height: 100%"></div>

  
  <script type="text/javascript" src="https://fastly.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>
  
  <!-- Uncomment this line if you want to dataTool extension
  <script type="text/javascript" src="https://fastly.jsdelivr.net/npm/echarts@5/dist/extension/dataTool.min.js"></script>
  -->
  <!-- Uncomment this line if you want to use gl extension
  <script type="text/javascript" src="https://echarts.apache.org/en/js/vendors/echarts-gl/dist/echarts-gl.min.js"></script>
  -->
  <!-- Uncomment this line if you want to echarts-stat extension
  <script type="text/javascript" src="https://echarts.apache.org/en/js/vendors/echarts-stat/dist/ecStat.min.js"></script>
  -->
  <!-- Uncomment this line if you want to echarts-graph-modularity extension
  <script type="text/javascript" src="https://echarts.apache.org/en/js/vendors/echarts-graph-modularity/dist/echarts-graph-modularity.min.js"></script>
  -->
  <!-- Uncomment this line if you want to use map
  <script type="text/javascript" src="https://fastly.jsdelivr.net/npm/echarts@4.9.0/map/js/world.js"></script>
  -->
  <!-- Uncomment these two lines if you want to use bmap extension
  <script type="text/javascript" src="https://api.map.baidu.com/api?v=3.0&ak=YOUR_API_KEY"></script>
  <script type="text/javascript" src="https://fastly.jsdelivr.net/npm/echarts@5/dist/extension/bmap.min.js"></script>
  -->

  <script type="text/javascript">
    var dom = document.getElementById('container');
    var myChart = echarts.init(dom, null, {
      renderer: 'canvas',
      useDirtyRect: false
    });
    var app = {};
    
    var option;

    let dataAxis = [2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022, 2023, 2024, 2025];
let rainAmounts = [404.6, 386.7, 295, 211.5, 764.8, 497.9, 591.3, 388.5, 938.6, 465.6, 378.2];

let differences = [];
for (let i = 1; i < rainAmounts.length; i++) {
  differences.push(rainAmounts[i] - rainAmounts[i-1]);
}

console.log('Differences:', differences);

let positiveData = [];
let negativeData = [];
let placeholderData = [];
let previousSum = [rainAmounts[0]]

placeholderData.push(rainAmounts[0]);

for (let i = 0; i < differences.length; i++) {
  let diff = parseFloat(differences[i]);
  
  if (diff >= 0) {
    positiveData.push(diff.toFixed(1));
    negativeData.push('-'); // Use 0 instead of '-' for proper stacking
  } else {
    positiveData.push('-'); // Use 0 instead of '-' for proper stacking
    negativeData.push(Math.abs(diff).toFixed(1));
  }
  

  // Add the cumulative value for the next placeholder
  if (diff < 0) {
    placeholderData.push(placeholderData[i] + diff);
  } else {
      placeholderData.push(placeholderData[i]);
  }
}
placeholderData = placeholderData.slice(1);

option = {
  title: {
    text: 'Variação Anual de Chuva - Fazenda Carnaúba'
  },
  tooltip: {
    trigger: 'axis',
    axisPointer: {
      type: 'shadow'
    },
    formatter: function (params) {
      let tar;
      if (params[1] && params[1].value !== '-') {
        tar = params[1];
      } else if (params[2] && params[2].value !== '-') {
        tar = params[2];
      } else {
        tar = params[0];
      }
      return tar.name + '<br/>' + (tar.seriesName === 'Placeholder' ? 'Total Acumulado' : tar.seriesName) + ' : ' + tar.value + ' mm';
    }
  },
  legend: {
    data: ['Aumento', 'Redução', 'Total Acumulado']
  },
  grid: {
    left: '3%',
    right: '4%',
    bottom: '3%',
    containLabel: true
  },
  xAxis: {
    type: 'category',
    data: dataAxis
  },
  yAxis: {
    type: 'value',
    name: 'Volume de Chuva (mm)',
    axisLabel: {
      formatter: '{value} mm'
    }
  },
  series: [
    {
      name: 'Placeholder',
      type: 'bar',
      stack: 'Total',
      silent: true,
      itemStyle: {
        borderColor: 'transparent',
        color: 'transparent'
      },
      emphasis: {
        itemStyle: {
          borderColor: 'transparent',
          color: 'transparent'
        }
      },
      data: placeholderData,
      label: {
        show: true,
        position: 'inside',
        formatter: '{c} mm'
      }
    },
    {
      name: 'Aumento',
      type: 'bar',
      stack: 'Total',
      label: {
        show: true,
        position: 'top',
        formatter: '+{c} mm'
      },
      itemStyle: {
        color: '#91CC75' 
      },
      data: positiveData
    },
    {
      name: 'Redução',
      type: 'bar',
      stack: 'Total',
      label: {
        show: true,
        position: 'top',
        formatter: '-{c} mm'
      },
      itemStyle: {
        color: '#EE6666' 
      },
      data: negativeData
    }
  ]
};

    if (option && typeof option === 'object') {
      myChart.setOption(option);
    }

    window.addEventListener('resize', myChart.resize);
  </script>
</body>
</html>
